title: darktable 2.6
lang: fr
author: Nilvus (traduction de l'article écrit par moy)
date: 2018-12-24
lede: butterfly.jpg
lede_author: 
tags: annonce, darktable-release

WARNING: Ceci est un brouillon qui ne doit pas être édité.
WARNING: L'édition de la traduction française se fait sur
WARNING: https://linuxfr.org/redaction/news/darktable-2-6

TODO: intro.

Parmi les principales nouveautés :

* Un nouveau module « retouche », similaire au module de « correction de tâches », avec copie intelligente (« outil de correction ») et la possibilité d'agir sur chaque niveau de détail individuellement.

* Un nouveau module « filmique », capable de gérer la plupart des aspects de tonalité d'une image en un seul module.

* Une refonte complète du module de « balance des couleurs », qui peut désormais être
  seen as a color-aware variant of "levels", et permet la plupart des ajustements automatiquement grâce à de nouvelles options de sélection de couleurs.

* La possibilité de guider le floutage du masque de fusion, afin de sélectionner précisément un objet avec le minimum d'effort.

# Fonctionnalités principales

## Un nouveau module : « retouche »


Alors que darktable se focalise principalement sur le développement raw, les dernières versions ont introduit des fonctionnalités habituellement réservées aux éditeurs orientés pixels tel que GIMP, comme le module « liquéfier ». 
Une étape importante de plus dans cette direction est faite avec ce nouveau module « retouche », qui remplace essentiellement le module « correction des tâches », avec séparation des fréquences pour une retouche fine.



### Améliorations comparées au module « correction des tâches »



Le module a bien plus d'options que le module « correction des tâches », mais tout ce que vous pouviez faire avec le précédent reste disponible dans le module « retouche ».



![Aperçu du module retouche](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-overview-fr.png)



Comme avec « correction des tâches », vous sélectionnez une forme (cercle, ellipse, chemin, ou brosse ; cette dernière n'existait pas dans « correction des tâches ») et vous cliquez simplement sur la partie de l'image que vous souhaitez effacer. Le module va copier une autre partie de l'image pour la masquer. Glissez au lieu de cliquer pour choisir la source à cloner, ou ajustez les contrôles ensuite.



De nombreux détails vont vous faciliter la vie :



#### Outil de correction, de meilleurs résultats en moins d'efforts



Par défaut, la copie utilise un algorithme de « correction » (*heal* en anglais) emprunté de l'outil correcteur de GIMP, qui adapte la source au contexte de l'emplacement copié. Vous n'avez pas besoin de copier *exactement* la bonne partie de l'image. Prenons un exemple classique, un petit défaut dans un ciel pas complètement uniforme :



![Exemple de retouche](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-original.png)



Une mauvaise tentative pour corriger cela avec l'outil de copie donnerait :



![Retouche par copie (avec contrôles)](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-clone.png)



Le morceau de ciel copié pour masquer le défaut est un peu plus sombre que l'endroit où il a été copié. Ce n'est pas évident tant que les outils de contrôle sont affichés sur l'image, mais l'image finale est vraiment mauvaise :



![Retouche par copie (sans contrôles)](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-clone-nocontrol.png)



La même retouche  avec le nouvel « outil de correction » (![outil de correction](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-heal-icon.png)) donne ceci :
 


![Retouche de correction (avec contrôles)](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-heal.png)



Cette fois, l'image finale est indistinguable d'un ciel sans défaut :



![Retouche de correction (sans contrôles)](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-heal-nocontrol.png)



Même en clonant des parties de l'image de couleurs complètement différentes, l'outil de correction réagit étonnamment bien. Poussons le module un peu :



![Retouche de correction sur des couleurs différentes](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-heal-red-white-blue.png)



Le morceau blanc est copié vers le t-shirt bleu, le t-shirt bleu vers le rouge, et le rouge vers le blanc. Chaque fois, le contraste local est conservé, mais la couleur générale et la luminance du morceau sont adaptés pour s'ajuster à la destination.



L'outil de copie basique (![outil de copie](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-clone-icon.png)) est toujours disponible pour les rares situations où vous en auriez besoin.



#### Remplir et flouter, quand vous n'avez rien à copier



En plus des outils de copie et de correction (qui fonctionnent seulement quand vous avez une partie de l'image à dupliquer sur celle à effacer), le module « retouche » fournit un outil de remplissage (![outil de remplissage](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-fill-icon.png)) (remplir une forme avec une couleur) et un outil de flou (![outil de flou](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-blur-icon.png)) (appliquer un flou pour adoucir une partie de l'image). Ces outils sont particulièrement utiles pour l'édition par séparation de fréquence (voir plus bas).



#### Une activation, plusieurs corrections : ajout continu



Les outils peuvent être activés en une fois pour plusieurs corrections. Utilisez simplement la combinaison `Ctrl`-`clic` sur l'un des outils cercle, ligne, ellipse ou chemin (au lieu d'un simple clic), et l'outil restera actif jusqu'à ce que vous le désactiviez explicitement.
Ceci est très pratique lorsque vous avez à corriger plusieurs endroits de la même image, comparé au précédent flux de travail qui vous obligeait à cliquer sur le bouton de l'outil pour chaque correction.

#### Visualisation de la source de correction



Pour les outils de copie et de correction, chaque correction consiste à sélectionner une source et une destination. Un simple clic permet de définir la destination et, par défaut, darktable sélectionne une zone arbitraire pour la source. Une autre option est de définir la source et la destination par un glisser-déposer avec le curseur de la destination vers la source.



« retouche » introduit un mécanisme plus avancé :



* En déplaçant le curseur sur l'image, la destination à corriger est marquée par une forme, alors que la source est marquée par une petite croix :



![Retouch source and destination](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-source-cross.png)



* Pour sélectionner une source, utiliser `Maj`-clic sur l'image. La croix est alors placée sur l'emplacement du curseur et ne bougera plus jusqu'à ce que vous sélectionnez la destination, via un simple clic. Ceci est particulièrement intéressant, combiné à une activation permanente de l'outil mentionné ci-dessus : plusieurs corrections sont ainsi possibles sur l'image, la source restant à des coordonnées relatives à la destination.



* Une variante : utiliser `Ctrl`-`Maj`-Clic au-lieu de `Maj`-Clic. Ceci définira également l'emplacement de la source, mais cette fois, celle-ci restera fixe, selon des coordonnées absolues et non plus relatives à la destination à corriger.



### Édition par séparation de fréquence



Un difficulté classique de la retouche photo, typiquement pour le portrait, est de souhaiter masquer certaines tâches, et parfois réduire le contraste local afin de rendre la peau plus lisse, tout en conservant sa texture.
Un effacement brutal rendrait la peau trop lisse et donnera à la photo, au mieux, un aspect « excessivement post-traité ».



Prenons une image comme exemple (reprise du [défi pixls.us PlayRaw](https://discuss.pixls.us/t/playraw-hillbilly-portrait/5518)) :



![Exemple de portrait](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-overall-portrait.jpg)



Une technique commune pour ce type de retouche est de séparer l'image en plusieurs images correspondant à plusieurs niveaux de détails, et de les combiner ensemble. C'est ce que permet le [greffon « Décomposer en ondelettes » de GIMP](https://pixls.us/articles/skin-retouching-with-wavelet-decompose/), par exemple.



Après séparation, une première image montre une image trouble aux détails grossiers, et une ou plusieurs images contenant seulement les détails.



Dans notre exemple, nous obtenons :



![Example portrait](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-portrait-scale4.jpg)



![Example portrait, scale 5](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-portrait-scale5.jpg)



![Example portrait, scale 6](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-portrait-scale6.jpg)
 


![Example portrait, scale 7](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-portrait-scale7.jpg)



Ce type de transformation est utilisée en interne par le module « égaliseur », qui permet d'augmenter ou diminuer l'importance de chaque niveau de détails de l'image. Alors que l'« égaliseur » travaille globalement sur l'image, « retouche » permet de sélectionner le niveau de détails et la partie de l'image sur laquelle vous souhaitez travailler.



Dans le module retouche, cela correspond à la partie _décomposition en ondelettes_ de l'interface :



![Wavelet decompose scales](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-scales-fr.png)



Cette partie montre un rectangle par échelle de décomposition (du grain le plus fin à gauche au grain le plus grossier à droite). Le rectangle noir à gauche corresponds à l'image entière, et le blanc à droite à l'image résiduelle, i.e. l'image où tous les autres niveaux de détails ont été enlevés. Par défaut, darktable montre toujours l'image finale, mais vous pouvez visualiser une échelle de détails et l'image résiduelle en cliquant sur le bouton « affiche une seule échelle de décomposition » (![affiche une seule échelle de décomposition](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-display-wavelet-scales.png)).



L'image actuellement sélectionnée apparaît avec un rectangle rouge. Déplacez le curseur du bas pour modifier le nombre d'échelles de détails à utiliser. Selon le niveau de zoom, certains détails d'échelle peuvent être plus fins que le permet la résolution de l'écran, donc inutilisables. La ligne grise sur le dessus des échelles montre lesquelles sont visibles au niveau de zoom actuel.



En visualisant l'échelle de détails, le contraste peut être trop faible ou trop fort, donc le module propose un ajustement de niveaux (qui s'applique seulement sur la prévisualisation à l'écran, et non sur l'image finale) :



![Levels adjustment](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-levels-fr.png)



Chaque type d'outil présenté ci-dessus (correction, copie, remplissage ou flou) est utilisable sur chacune de ces échelles. Pensez-y comme à des calques obtenus d'une image source, et recomposées ensemble, après retouche, afin d'obtenir l'image finale. C'est là où les outils de « remplissage » et de « flou » prennent le plus de sens : « remplissage » est par défaut un mode d'effacement lorsque la couleur choisie est le noir, ce qui correspond à supprimer les détails lorsqu'utilisé sur les échelles de détails. Il est aussi possible de sélectionner une couleur et de remplir avec celle-ci (particulièrement utile sur l'échelle de l'image résiduelle). Utiliser l'outil de « flou » directement sur l'image, aboutit à des résultats de post-traitement clairement visibles, mais l'utiliser de manière sélective sur les échelles, permet d'aboutir à des effets plus subtils.



#### Exemple 1: réduction de tâche au lieu de suppression



Concentrons-nous sur le bouton situé sous la branche des lunettes. Si nous souhaitons le supprimer complètement, il est facile de le faire avec l'outil de correction. Maintenant, que se passe-t-il si nous souhaitons le conserver, mais simplement le réduire, pour qu'il n'attire plus l'attention ? Nous pouvons simplement le supprimer depuis l'échelle de détails grossiers (échelle 6 dans notre exemple).
Le bouton n'est alors plus visible sur l'image résiduelle, donc le supprimer depuis l'échelle de détails est suffisant. L'outil de correction permet de le faire proprement. Mais en agissant avec l'échelle de détails, les outils de remplissage et de flou peuvent aussi donner de bons résultats. Voici ci-dessous le résultat sur l'échelle 6 (avant à gauche, après à droite).



![Before/after at scale 6](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-before-after-scale6.jpg)



L'image finale sera transformée comme suit :



![Before/after at scale 6 (final image)](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-before-after-final.jpg)



Désormais, nous pouvons décider que la correction faite sur l'échelle 6 peut aussi s'appliquer à l'échelle 5. Nous pouvons faire la même chose manuellement, mais nous pouvons également utiliser le curseur du haut, intitulé « début de fusion », afin de reproduire automatiquement les formes corrigées sur plusieurs échelles. Toute forme créée à droite de ce curseur sera reproduite sur toutes les échelles au delà de ce curseur de fusion (excepté si le curseur est positionné complètement à gauche (à 0), ce qui signifie que la fusion est désactivée).
Par exemple, en positionnant le curseur à 5, nous appliquons la correction sur les échelles 5 et 6, et obtenons ceci :



![Before/after at scale 6](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-merge-5-6.jpg)



Si nous déplaçons le curseur plus à gauche, le bouton disparaît progressivement. Selon ce même principe, nous pouvons effacer les marques sur la peau tout en préservant les poils de la barbe :



![Before/after, preserving beard](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-beard-preserve.jpg)



(Juste une correction sur l'échelle 7, propagée ensuite jusqu'à l'échelle 5 en utilisant le curseur de fusion)



#### Exemple 2: jouer avec la texture de peau



Si vous voulez changer la texture de peau sur la joue, vous pouvez appliquer un flou sur une forme de ce type :



![Blur on a detail scale](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-blur-detail.jpg)



et obtenez le résultat avant/après suivant :



![Changing the skin texture](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-skin-texture.jpg)



De toute évidence, ce type de retouche doit être pratiqué avec une grande prudence : si la correction est poussée trop loin, cela produira un aspect trop artificiel.



En cas de doute, vous pouvez toujours revenir en arrière sur votre retouche et utiliser un mode de fusion avec une opacité inférieure à 100%, ou modifier l'opacité ou le rayon de flou de chaque forme individuellement.



#### Exemple 3: s'amuser avec l'image résiduelle



Juste pour le plaisir (ne reproduisez pas ça chez vous, ou attendez-vous à des images horribles !), nous pouvons obtenir un effet « tatouage » en utilisant l'outil de copie sur l'image résiduelle :


![Copie sur l'image résiduelle](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/rt-clone-residual-image.jpg)


Bien que peu élégant, cet exemple illustre le principe de « séparation de fréquence » : nous avons conservé les détails fins de la joue, et copié des détails grossiers de l'image résiduelle.


## Nouveau module : filmique


Le module filmique a été conçu pour reproduire les meilleurs aspects d'un film analogique, associés aux contrôles plus aisés de la photographie digitale. Il peut être utilisé sur tout image en remplacement du module "courbe de base", et est particulièrement adapté pour les images à grande gamme dynamique (high dynamic range - HDR), i.e. une différence importante entre les zones les plus clairs et les plus sombres de l'image.

Prenons un exemple d'une telle image :

![Example HDR image](https://raw.githubusercontent.com/moy/dtorg/a925974d80d6d088d2007c8955328d7860b29128/content/blog/2018-12-25-darktable-2.6/filmic-example-image.jpg)

A common approach to deal with high dynamic range images is to compress the global contrast while retaining the local one. darktable has several modules able to do this: "tone mapping", "global tonemap", "shadows and highlights", and since darktable 2.2 the exposure fusion mode in the "base curve" module. This contrast compression works to
some extend, but results in artificial look when pushed too far. What you typically want to avoid is this (using "tone mapping", contrast compression set to the maximum):

![Example HDR image](https://raw.githubusercontent.com/moy/dtorg/a925974d80d6d088d2007c8955328d7860b29128/content/blog/2018-12-25-darktable-2.6/filmic-hdr-too-much.jpg)

The filmic module shows that another approach is possible, and usually gives more natural results. It considers pixels individually, without trying to distinguish between local and global contrast. If filmic compresses the contrast too much, it is still possible to recover local contrast with the excellent "local contrast" tool for example.

"filmic" is meant to be used without the "base curve" module (activated by default in darktable). The base curve comes very early in the pipeline and yields a contrasty image where highlights are often blown out. Recovering details lost by the base curve is
difficult. On the other hand, just disabling the base curve usually results in fade images, lacking contrast and saturation. Other contrast enhancement techniques must be used to compensate for this. filmic comes later than "base curve" in the pipeline, and gives more control to exploit the dynamic range of the output image properly.

The first thing "filmic" does is to apply a logarithmic curve to the image, so that the "stops" (factor of two in luminance in a linear space) are spread evenly on the histogram.

A source of inspiration behind "filmic" is analog film. One difference between analog film and digital sensors is the way they react to overexposure. Digital sensors have a clipping threshold above which everything is considered white: they can't distinguish between pixels slightly above the threshold and pixels grossly overexpose. Analog
film respond differently: contrast is reduced progressively as the image is overexposed, without this threshold effect. This allows analog films to render a scene with a high dynamic range on a medium with a lower dynamic range, while keeping contrast in the midtones.

Similar effect can be obtained in the digital world by applying an S-shaped curve to the image, as long as the highlights are not clipped. With the tone curve module, one can draw a curve like this one:

![Exposure adjustment](https://raw.githubusercontent.com/moy/dtorg/a925974d80d6d088d2007c8955328d7860b29128/content/blog/2018-12-25-darktable-2.6/filmic-S-shaped.png)

The second thing filmic does is to apply such curve, but instead of providing the curve manually, the curve is computed automatically from a set of parameters. This makes it easy to balance shadows, highlights and midtones.

### Exemple d'image

Let's process our image with this module. Before applying filmic, we first need to disable the "base curve module", and then to adjust the exposure. No pixel should be overexposed nor underexposed. In our case, we need to reduce the exposure to avoid overexposing the sky:

![Exposure adjustment](https://raw.githubusercontent.com/moy/dtorg/a925974d80d6d088d2007c8955328d7860b29128/content/blog/2018-12-25-darktable-2.6/filmic-exposure.jpg)

For the automatic setting to work best, it is also advised to use the "demaze" mode in the demosaic module. Activating a noise reduction module coming before filmic in the pipeline (e.g. "denoise (profiled)") may help, too.

### Forme logarithmique

The first thing displayed in the filmic module is an overview of the curve applied to the image. The curve is not editable directly, the point of the module being to compute the curve from the sliders below.

To get a good starting point, filmic provides an "auto tune level" picker. By default, it considers the whole image, and sets the three sliders above based on average luminance, brightest area and darkest area:

![One click on "auto tune levels"](https://raw.githubusercontent.com/moy/dtorg/a925974d80d6d088d2007c8955328d7860b29128/content/blog/2018-12-25-darktable-2.6/filmic-autotune-levels.jpg)

The black cursor is often wrong. It is actually not an easy task for an automatic tool to pick the right black level (it can't take an absolute black as reference, since absolute black would be mapped to -infinity in a log scale). One can fix it either by guessing the dynamic range of the image (on a contrasty enough image, this is the dynamic range of the camera, i.e. around 14 EV on a high-end camera or around 10 EV for an average compact camera). The black cursor can be set to the value of the white one minus the dynamic range. Alternatively, one can move the cursor to let the histogram fill its horizontal axis. In our case, we also need to tweak the white cursor to get the sun completely to the right of the histogram:

![Manual adjustment of black and white levels](https://raw.githubusercontent.com/moy/dtorg/a925974d80d6d088d2007c8955328d7860b29128/content/blog/2018-12-25-darktable-2.6/filmic-adjust-white-black.jpg)

After these settings, the histogram is spread over the dynamic range of the target image. No pixel are overexposed:

![Histogram after adjustment](https://raw.githubusercontent.com/moy/dtorg/a925974d80d6d088d2007c8955328d7860b29128/content/blog/2018-12-25-darktable-2.6/filmic-adjust-histogram.png)

Now comes the magick: the "middle grey luminance" picker allows us to chose which part of the image will be considered as middle grey (50% luminance). For example, if we set it on the cheek of the dog, we get this:

![Middle grey on the dog's cheek](https://raw.githubusercontent.com/moy/dtorg/a925974d80d6d088d2007c8955328d7860b29128/content/blog/2018-12-25-darktable-2.6/filmic-middle-grey-dog.jpg)

If we select the nose of the dog, which is much darker, we get this brighter image:

![Middle grey on the dog's nose](https://raw.githubusercontent.com/moy/dtorg/a925974d80d6d088d2007c8955328d7860b29128/content/blog/2018-12-25-darktable-2.6/filmic-middle-grey-nose.jpg)

On the other hand, if we select a bright area in the sky, the overall exposure is lowered to get proper exposure on the sky:

![Middle grey on the sky](https://raw.githubusercontent.com/moy/dtorg/a925974d80d6d088d2007c8955328d7860b29128/content/blog/2018-12-25-darktable-2.6/filmic-middle-grey-sky.jpg)

For all these images, the black and white points are kept, no over or underexposure. In the end, picking the grass behind the dog is probably the best option here, but it's a matter of taste:

![Middle grey on the grass](https://raw.githubusercontent.com/moy/dtorg/a925974d80d6d088d2007c8955328d7860b29128/content/blog/2018-12-25-darktable-2.6/filmic-middle-grey-grass.jpg)

### Courbe filmique en S

Let's now move to the second part of the module: the S-shaped curve. Basically, it will increase the contrast in the midtones (the "contrast" slider) and compress shadows and/or highlights. You may not have noticed it, but filmic has already been doing so since we activated it, as the "contrast" slider is set to 1.5 by default. If we disable the S-shaped curve (setting "contrast" to 1), we get a duller image:

![No contrast in S-shaped curve](https://raw.githubusercontent.com/moy/dtorg/a925974d80d6d088d2007c8955328d7860b29128/content/blog/2018-12-25-darktable-2.6/filmic-no-contrast.jpg)

On the other hand, we can add more contrast than done by default:


![High contrast in S-shaped curve](https://raw.githubusercontent.com/moy/dtorg/a925974d80d6d088d2007c8955328d7860b29128/content/blog/2018-12-25-darktable-2.6/filmic-high-contrast.jpg)

Of course, at some point increasing the contrast will result in loosing information in shadows and/or highlights. The curve at the top of the module allows you to see what information is lost: ideally the curve should not touch the top or bottom of the frame. If you get this curve, you've destroyed your shadows:

![Clipped shadows](https://raw.githubusercontent.com/moy/dtorg/a925974d80d6d088d2007c8955328d7860b29128/content/blog/2018-12-25-darktable-2.6/filmic-curve-clipped-shadows.png)

The sliders below "contrast" allow you to fine-tune the curve:


* "latitude" gives the range of the image considered as midtone, in
  which contrast will be increased.


* "balance shadows-highlight" allows giving more room either to
  shadows or to highlights.


* The "intent" dropdown controls the interpolation between points of
  the curve. The default usually provides good results but can also go
  really wrong (e.g. produce a non-monotonic curve) when you push the
  parameters to their extreme. Try other modes when this happens.


Increasing contrast often results in an increase of saturation, and gamut clipping. The "saturation" slider allows decreasing the saturation in the shadows and highlights to avoid this. On the other hand, in highlights, darktable usually has to chose between preserving the luminance and the chrominance. By default, it preserves the luminance but the checkbox allows doing the opposite.

There's a hidden section "destination/display", useless for most users. Expect ugly images if you use it without reading the manual and knowing what you're doing!

### Touche finale et contraste local

The contrast has been compressed in the sky, but we still see some texture there. If we want to increase local contrast in the sky, the "local contrast" tool with a parametric mask on the brightest part of the image gives this:

![Middle grey on the grass](https://raw.githubusercontent.com/moy/dtorg/a925974d80d6d088d2007c8955328d7860b29128/content/blog/2018-12-25-darktable-2.6/filmic-and-local-contrast.jpg)

### Documentation complémentaire

Cette partie vous donne un aperçu de ce qui est possible avec le module filmique. Bien entendu, il est recommandé de lire la manuel de darktable pour plus de précisions.
Pour de plus amples informations (plus de détails techniques, comparaison avec d'autres techniques, exemples d'images réelles, ...), vous pouvez également lire l'article suivant (en anglais) : "[Filmic, darktable and the quest of the HDR tone mapping](https://eng.aurelienpierre.com/2018/11/30/filmic-darktable-and-the-quest-of-the-hdr-tone-mapping/)", par Aurélien Pierre, le créateur du module.

## Gestion des clones dans la table noire

darktable vous permet de conserver plusieurs historiques différents de la même image. En cliquant sur le bouton « cloner » dans le module « images sélectionnées » de la table lumineuse, cela donne un clone de l'image : le fichier RAW n'est pas copié, mais darktable conserve ainsi deux piles d'historique distinctes pour cette image.

darktable 2.6 facilite encore plus le travail avec des clones, grâce au nouveau module apparaissant dans le panneau gauche de la chambre noire :

![Duplicate manager](https://raw.githubusercontent.com/moy/dtorg/a925974d80d6d088d2007c8955328d7860b29128/content/blog/2018-12-25-darktable-2.6/dm-initial.png)

Tout d'abord, évidemment, le module étant dans la chambre noire, il est désormais possible de travailler avec les différents clones, sans quitter cette dernière.
Deuxième amélioration : un bref commentaire peut désormais être associé à chaque clone de l'image. Supposons que nous souhaitons comparer notre image développée via le module « filmique » avec un développement fait via la fonction de « fusion d'exposition » du module « courbe de base ». Nous pouvons démarrer avec un ajustement d'exposition basique et conserver cette version pour des développements futurs :

![Duplicate manager](https://raw.githubusercontent.com/moy/dtorg/a925974d80d6d088d2007c8955328d7860b29128/content/blog/2018-12-25-darktable-2.6/dm-basic.png)

Ensuite, un clic sur le bouton « créer un clone avec le même historique » (![créer un clone](https://raw.githubusercontent.com/moy/dtorg/a925974d80d6d088d2007c8955328d7860b29128/content/blog/2018-12-25-darktable-2.6/dm-create-duplicate.png)) donne un clone sur lequel nous pouvons appliquons notre traitement basé sur le module « filmique » :

![Duplicate manager](https://raw.githubusercontent.com/moy/dtorg/a925974d80d6d088d2007c8955328d7860b29128/content/blog/2018-12-25-darktable-2.6/dm-filmic.png)

Afin d'obtenir une nouvelle version, nous sélectionnons d'abord le premier par un double-clic avant de créer un clone :

![Duplicate manager](https://raw.githubusercontent.com/moy/dtorg/a925974d80d6d088d2007c8955328d7860b29128/content/blog/2018-12-25-darktable-2.6/dm-fusion.png)

Pour comparer les clones, un simple clic prolongé sur un autre montre cette version de l'image via un niveau de zoom ajusté à l'écran. Il vous faudra maintenir le clic jusqu'à ce que l'image soit affichée complètement la première fois. L'opération sera immédiate par la suite, vous permettant de cliquer et relâcher plusieurs fois afin d'obtenir une comparaison avant/après instantanée.

Notez bien que les miniatures de l'image sont seulement mises à jour lorsque vous quittez l'image. La miniature de l'image tout juste éditée n'est donc, en général, pas à jour.

## Refonte du module « balance couleur »



6. le module de balance des couleurs propose deux nouveaux modes basés
sur ProPhotoRGB et en HSL.



## Floutage par détection de bords des masques de fusion



La fonction de fusion de darktable permet de sélectionner une partie de l'image, appelée un masque, afin d'appliquer la transformation apportée par le module sur cette partie. Après création du masque (dessiné ou paramétrique), il est possible d'adoucir les bords du masque avec un effet de floutage.



darktable 2.6 donne plus de contrôle sur la manière dont le floutage du masque est rendu. Afin d'en comprendre le fonctionnement, regardons les deux principales méthodes de floutage. La plus commune est le flou gaussien, et donne en gros le même effet qu'une photo avec une mise au point incorrecte. En flou gaussien, la valeur (luminance et chrominance) de chaque pixel est diffusée uniformément aux pixels environnants. L'effet de diffusion s'atténue à mesure qu'on s'éloigne du pixel de départ. Dans darktable, le flou gaussien est disponible dans le module « filtre passe-bas » :

![Copie sur l'image résiduelle](https://raw.githubusercontent.com/Nilvus/dtorg/3e455aa26cec00f41f386ec2fd3d68a6cad3c821/content/blog/2018-12-25-darktable-2.6/gaussian-blur-fr.png)



Un autre type de floutage se base sur le [filtre bilatéral (article en anglais)](https://en.wikipedia.org/wiki/Bilateral_filter), parfois appelé flou de surface (en raison du nom de l'outil correspondant dans Photoshop), ou floutage par détection de bord. Dans ce mode, la valeur de chaque pixel est étendue aux pixels environnants, mais l'influence d'un pixel est réduite quand les pixels ont des valeurs différentes. Par exemple :



![Copie sur l'image résiduelle](https://raw.githubusercontent.com/Nilvus/dtorg/b3118285ba128ef422d5b0e6b3f08a589efdf73a/content/blog/2018-12-25-darktable-2.6/edge-aware-blur-fr.png)



Un algorithme de floutage similaire peut être appliqué au masque, mais cette fois le masque est flouté et l'image résultante sert de guide pour le floutage. Ceci permet de définir grossièrement le masque et de l'affiner ensuite précisément avec les curseurs.


Supposons que nous souhaitions améliorer la couleur du ciel. Dans le module «  zones de couleurs  », nous pouvons sélectionner le ciel avec un masque dessiné :


![Masque dessiné](https://raw.githubusercontent.com/Nilvus/dtorg/b3118285ba128ef422d5b0e6b3f08a589efdf73a/content/blog/2018-12-25-darktable-2.6/gb-mask-fr.png)



Évidemment, le résultat est pire avec un flou gaussien sur ce masque (i.e. le seul disponible dans darktable 2.4) :



![Masque dessiné](https://raw.githubusercontent.com/Nilvus/dtorg/3654bb506b012e1b738c5b0ff9a553b5fce7cecb/content/blog/2018-12-25-darktable-2.6/gb-mask-gauss-fr.png)



Cependant, en poussant le curseur du « rayon adoucissement », le masque s'ajuste automatiquement au ciel, sans propagation aux montagnes. L'adoucissement réduit un peu l'opacité du masque. Cela peut être compensé avec le curseur d'« opacité du masque ». Et voilà :


![Masque dessiné](https://raw.githubusercontent.com/Nilvus/dtorg/3654bb506b012e1b738c5b0ff9a553b5fce7cecb/content/blog/2018-12-25-darktable-2.6/gb-mask-feather-fr.png)
  

Notez qu'en poussant les curseurs de « rayon adoucissement  » et «  opacité du masque  », cela vous donne un outil similaire à l'«  outil de sélection contiguë  » de GIMP,  souvent demandé par les utilisateurs de darktable : sélectionnez quelques pixels dans une zone, et laissez l'outil sélectionner les pixels similaires environnants.


Par exemple, via un coup de pinceau à l'intérieur de la maison :



![Pinceau, sans adoucissement](https://raw.githubusercontent.com/Nilvus/dtorg/3654bb506b012e1b738c5b0ff9a553b5fce7cecb/content/blog/2018-12-25-darktable-2.6/gb-brush-nofeather-fr.png)



Et maintenant en augmentant l'adoucissement :



![Pinceau, avec adoucissement](https://raw.githubusercontent.com/Nilvus/dtorg/3654bb506b012e1b738c5b0ff9a553b5fce7cecb/content/blog/2018-12-25-darktable-2.6/gb-brush-feather-fr.png)



# Améliorations de la table lumineuse et de la table



* Search for the map view should work better.
  TODO: details?



* The look of the lighttable has been improved. The background text
  showing the image format was often unreadable because it was hidden
  by the picture. The state of the local copy is now displayed in the
  top right corner.



* One can now sort images by aspect ratio (possibly after croping
  within darktable):



![Sort by aspect ratio](https://raw.githubusercontent.com/Nilvus/dtorg/2f031849b7818b775cee0151502daa2ad16f6195/content/blog/2018-12-25-darktable-2.6/lt-sort-by-fr.png)



* It is also possible to specify the order manually, by selecting
  "custom sort" and then drag-and-dropping the images to reorder them:



![Custom sort](https://raw.githubusercontent.com/Nilvus/dtorg/2f031849b7818b775cee0151502daa2ad16f6195/content/blog/2018-12-25-darktable-2.6/lt-custom-sort-fr.png)



* Collections can be filtered by aspect ratio, shutter speed
  (exposure) and state of local copy:



![Collection filters](https://raw.githubusercontent.com/Nilvus/dtorg/2f031849b7818b775cee0151502daa2ad16f6195/content/blog/2018-12-25-darktable-2.6/lt-collection-filters-fr.png)



* When selecting a filter to collect images, the number of images
  corresponding to each filter is displayed. In the example below, 13
  images were taken at 1/2000 and 27 at 1/1600:



![Number of images per collection](https://raw.githubusercontent.com/Nilvus/dtorg/2f031849b7818b775cee0151502daa2ad16f6195/content/blog/2018-12-25-darktable-2.6/lt-collection-nb-fr.png)



2. amélioration visuelle de la table lumineuse, code couleur, type image, état de copie locale, possibilité d'afficher des informations directement sur la miniature



3. possibilité d'avoir des ascenseurs sur la table lumineuse ou sur la table lumineuse et la chambre noire
11. amélioration du support de turboprint (choix du type de papier, dialogue turboprint complet affiché avant impression) 
30. meilleur support des groupes (étoiles, notes sur toutes les photos regroupées)
31. ajout un tri par groupe de photo
28. différents types de sélection pour les tags hiérarchiques dans le module collection


# Autres fonctionnalités importantes



## Finer control on noise for profiled denoise and raw denoise



New curves have been introduced to give finer control for the "wavelet" mode of profiled denoise as well as the raw denoise module.
These curves allow controlling the force of denoising frequency by frequency.
In other words, you can adapt the force of the denoising to the noise coarseness.
The "all" curve allow to change the force for all channels at the same time, while "R", "G" and "B" curves allow changing the force separately for red, green, and blue channels.
It was already possible to denoise red, green and blue channels
selectively using the "RGB red/green/blue channel" blend modes, but
the new module can do this with a single instance and no blending.

Let's see an example of what can be done with the "all" curves first.
First, zoom into the image to be at a 100% zoom level.
At smaller zoom levels the result is an approximation, which is not always accurate.
Let's activate the denoise profiled, in wavelet mode.
A force between 0.150 and 0.3 is usually a good starting point.
Here, to better see the influence of the curve, we use a force of 0.5.


Here is the image we obtain with a flat curve:


![Boat denoised using a flat curve](https://raw.githubusercontent.com/moy/dtorg/27e2db03af22d334d9a529081180ab25af3224f6/content/blog/2018-12-25-darktable-2.6/wavelets_flat.png)

Now, by lowering the force on a specific frequency, we can obtain very different results.
Here is what we obtain when lowering the force on a quite coarse frequency:
![Boat denoised with less reduction on the central frequency](https://raw.githubusercontent.com/moy/dtorg/27e2db03af22d334d9a529081180ab25af3224f6/content/blog/2018-12-25-darktable-2.6/wavelets_coarse_noise.png)


The result is not pleasing to the eyes because coarse grain noise are very disturbing.
Here, we reduced the denoising force too much.

Let's try the same test on the finest frequency:
![Boat denoised with less reduction on the finest frequency](https://raw.githubusercontent.com/moy/dtorg/27e2db03af22d334d9a529081180ab25af3224f6/content/blog/2018-12-25-darktable-2.6/wavelets_details.png)
Here, we obtain an image which is much less disturbing than the last one: the fine grain noise is less distrurbing than the coarse grain one.
This image is even arguably more natural than the one with a flat curve.

By playing with the different frequencies, on can get better trade-offs between smoothing and detail preservation.


In addition, new presets are now available for the denoise profile module that exploit this curve:


* one for chroma noise (false colors), where the denoising is increased for fine details, as the color should not change much from one pixel to another.


* one for luma noise (false luminance), where the denoising is reduced on finest details and some coarse scales. It aims at providing a nice trade-off between noise and smoothing for pictures that are not too noisy (forget about extended ISO values for instance. For such pictures we have to use less automatic strategies).


The chroma preset should be used on the first instance, and the luma preset on the second instance.


For images that are more complicated, or if you want to get an even better trade-off, you can use the RGB curves.
Indeed, the sensors usually capture R, G, and B values.
Depending on the lighting on the scene, the channels can exhibit different noise characteristics:


* one of the channel may be more (or even much more) noisy than the other


* one channel may have coarser noise than another


You can try to get a better denoising trade-off by denoising the channels separately, using the RGB curves and an instance of channel mixer used to visualize the channels:
![Denoising the red channel](https://raw.githubusercontent.com/moy/dtorg/27e2db03af22d334d9a529081180ab25af3224f6/content/blog/2018-12-25-darktable-2.6/wavelets_red.png)
Once RGB channels have been denoised, you can use another instance in color blend mode to remove remaining color problems.

Note that denoising RGB channels individually should be done *before* using an instance in color blend mode, as doing this will mix the channels and change the characteristics of noise.


These explanations were all using the denoise profiled module as an example, but you can follow the same steps with the "raw denoise" module.
Also note that the tip of denoising RGB channels separately while visualizing the channels using the channel mixer is also useful to set the parameters of the denoise bilateral module.

## A new "log" mode for "unbreak input profile"



TODO



## Ability to adjust the opacity of each stoke in "spot removal"



TODO



## Amélioration du support des fichiers RAW monochromes



TODO



## Improvement of multiple modules instance support



### Ability to rename module instances



TODO



### Amélioration du couper/coller



TODO



### One click to apply a preset in a new instance



TODO



## Ratio-preserving crop in the perspective correction module



The perspective correction module now allows a semi-automatic cropping preserving the original image's format:


![Automatic croping to original format](https://raw.githubusercontent.com/Nilvus/dtorg/2f031849b7818b775cee0151502daa2ad16f6195/content/blog/2018-12-25-darktable-2.6/pc-original-format-fr.png)



Just drag the mouse over the image to select the portion to crop:



![Cropping an image](https://raw.githubusercontent.com/Nilvus/dtorg/2f031849b7818b775cee0151502daa2ad16f6195/content/blog/2018-12-25-darktable-2.6/pc-crop-image.jpg)



The area is adjusted automatically to avoid including black parts in the target image. This avoids having to switch to the "crop and rotate" module.


# Améliorations d'utilisation



## Aide contextuelle



TODO



## Module organisation into tabs



TODO



## Import/export vers d'autres logiciels



10. amélioration de l'import Lr (“creator”, “rights”, “title”, “description”, “publisher”)
33. nouveau script pour récupérer les collections de Capture One Pro


## Tone curve


The user-interface of the tone curve has been improved in several ways. First, you can now use a log scale on the x axis, y axis, or both:

![Log-log scale on tone curve](https://raw.githubusercontent.com/moy/dtorg/master/content/blog/2018-12-25-darktable-2.6/tone-curve-loglog.png)

This makes it easier to manipulate points close to 0, i.e. finely tweak the part of the curve affecting shadows.

It is also possible to chose the algorithm used for interpolation, i.e. for computing the curve itself based on the control points edited by the user. There were already several algorithms available, but hidden to the user. For example, selecting the preset "contrast - high (linear)" was picking a cubic spline for you. For very smooth curves, the interpolation algorithm doesn't change much on the result, but for curves using points close to each other it may make a dramatic change.

For example, let's look at the same set of control points with different interpolations. The cubic spline gives a very smooth curve, but may give a non-monotonic result, i.e. a contrast inversion on the resulting image:

![Cubic spline](https://raw.githubusercontent.com/moy/dtorg/master/content/blog/2018-12-25-darktable-2.6/tone-curve-cubic.png)

The centripetal spline reduces the potential for non-monotonicity:


![Centripetal spline](https://raw.githubusercontent.com/moy/dtorg/master/content/blog/2018-12-25-darktable-2.6/tone-curve-centripetal.png)

The monotonic spline, used by default, may be less smooth but avoids non-monotonicity by construction:

![Monotonic spline](https://raw.githubusercontent.com/moy/dtorg/master/content/blog/2018-12-25-darktable-2.6/tone-curve-monotonic.png)

## Autres améliorations



* More widgets are themable through CSS. In particular, some widgets
  hardcoded a light foreground and black background so it was not
  possible to make a clean white background theme.


* 50%, 400%, 800% and 1600% zoom level are available in darkroom mode.
  While most operations provided by darktable are meant to improve the
  overall image tone and colors, it is sometimes interesting to get a
  precise pixel-level view of a small part of the image. The highest
  zoom factor previously available (200%) was not always sufficient,
  especially on high-dpi screens. Note that these zoom levels are
  available from the menu in the preview area, but not with mouse
  wheel.

![1600% Zoom Level](https://raw.githubusercontent.com/Nilvus/dtorg/2f031849b7818b775cee0151502daa2ad16f6195/content/blog/2018-12-25-darktable-2.6/zoom-1600-fr.png)



* All masks are previewed and can be adjusted before being drawn. This
  also applies to the "liquify" module's shapes.


* The color picker's behavior has been reworked. For example the
  picker in the exposure module wasn't disabled when the module was
  disabled. This is becoming more important as more and more modules
  use a color picker (filmic, unbreak input profile, color balance).
