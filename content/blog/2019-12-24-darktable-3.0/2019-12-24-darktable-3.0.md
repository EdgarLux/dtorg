title: darktable 3.0
author: Nilvus
slug: darktable-30
date: 2019-12-24
lede: darktable3.0.jpg
lede_author: <a href="https://https://github.com/Nilvus/darktable/">Nilvus</a>
tags: announcement, darktable-release

<!-- In other languages: -->
<!-- [Français](https://linuxfr.org/news/darktable-3-0-une-version-plus-que-majeure), -->
<!-- [Italiano](https://www.mauriziopaglia.it/darktable-3-0/). -->

Following the tradition, darktable 3.0 was released for Christmas. After a lot of renewal in 2018, 2019 has seen many very unexpected changes in darktable, both in its user interface and in its internal mechanisms. This makes darktable 3.0, a more than major version, justifying the direct transition from version 2.6.x to version 3.0.

The announcement and release notes for this new release can be found here:
[https://www.darktable.org/2019/12/darktable-300-released/](https://www.darktable.org/2019/12/darktable-300-released/).

Among the new major features (the list is huge):

* A brand new GUI, more modern, fully redesigned and customizable via GTK+ CSS rules. There is no more size, color, fixed position in the Gtk C darktable code. This version already comes with several themes.
* A new "culling" mode on the lighttable. It displays a fixed number of consecutive images starting from the first selected (or a set of selected images), and allows you to pan & zoom them. The number of displayed images can be set by the user, and they can be navigated with the mouse wheel and keyboard. Finally, it provides a comparison mode of images often requested.
* A new timeline view, making possibility to select a date range to display related images
* A quite extensive rewrite of the lighttable view (including the filmstrip in darkroom view) has been made to greatly improve the overall performance. The lighttable is now usable on 4K and 5K monitors. darktable 3.0 also brings many code optimizations for CPU and SSE paths.
* A new _filmic RGB_ module which, like the previous module _filmic_, is designed to replace _basic curve_, _shadows and highlights_ and other global tone-mapping modules. This new version should be easier to use and it will reduce color casts. The old _filmic_ module is now depreciated and only available on images where it was previously used.
* A new module _tone equalizer_ has been created to merge the features of _zone system_, _shadows and highlights_, and (local) *tone mapping* modules in a scene-referred RGB space. It brings an easy and safe way to remap tones locally, performing a quick zone-based dodging and burning using the [zone system](https://www.wikiwand.com/fr/Zone_system) of [Ansel Adams](https://www.wikiwand.com/fr/Ansel_Adams).
* New modules _curve RGB_ and _levels RGB_. They have modes for linked and independant RGB channels.
* The module _noise reduction (profile)_ has been greatly improved. It now offers high-performance default settings in most cases. It is thus no longer necessary to use the two chroma and luma instances. In most cases only one instance is sufficient. For images processed with darktable 2.6 or earlier, it is possible to upgrade the module to the new processing algorithms via a checkbox in the module.
* A new module _3D lut_, for handling 3D RGB Lut transformations (PNG Hald-CLUT and Cube files are supported).
* A complete rework of the _tagging_ module. It is now faster and more complete, with a new hierarchical view, possibility to designate tags private or by categories or even search synonyms.
* Export module have now an option to select which metadata to export. 
* A new module _basic adjustments_. It allows you to adjust the black level, exposure, highlight compression, contrast, middle grey, brightness and saturation. It also has an auto feature based on Rawtherapee’s auto levels that can work on the entire image or a user selected area.
* A new *raster mask*, a copy of a parametric mask that allow possibility to apply this mask on whole modules in the pixel-pipe.
* And many other minor (but useful) features. We will talk about some of them, in the last part of this article.

As with every darktable major release, the database format changes, so **you can't go back to the previous version once you go to 3.0** : it's always advisable to make a backup of your database (~/.config/darktable/ directory) **before** the update.
However, darktable 3.0 introduces an automatic backup of your database in version 2.6 or earlier due to so many changes darktable brings, and particularly a whole rework of pixel-pipe order.

# Major features

## A whole new complete CSS themable GUI

darktable 3.0 introduce now a more modern and completely themable GUI by CSS. It is now also compatible with 4k and 5k monitors. With that whole rework, four themes have been introduced :

* _darktable_: the adapted original theme (by default), it uses the default font of the operating system.

![darktable theme](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/darkable.png)

darktable 3.0 specifically introduces the following three new themes (in addition to the default theme adapted to the new interface).
**These three themes, called _elegant_, require the installation of _Roboto_ fonts to achieve the desired complete visual experience.

* _darktable-elegant-darker_ : similar to default theme but with the Roboto more condensed font.

![darker theme](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/darkertheme.png)

* _darktable-elegant-dark_ : lighter version.

![dark theme](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/darktheme.png)

* _darktable-elegant-grey_ : even lighter version. Near to middle-grey.

![grey theme](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/greytheme.png)


Apart from any aesthetic considerations, the recommended interface colour for colour evaluation is middle grey (interface L = 45, background L = 75), close to ISO 12646:2008. Indeed, visual perception is affected by ambient brightness, and a low brightness of the interface causes all kinds of illusions:

1. exaggeration of the exposure perceived in the image (highlighted by the experience of the [Adelson's checker shadow illusion](https://en.wikipedia.org/wiki/Checker_shadow_illusion)): the image seems clearer than it is,
1. decrease in the perceived saturation in the image (Hunt effect): the colors seem less rich,
1. decrease in perceived contrast in the image ([Bartleson-Breneman effect](https://www.hisour.com/color-appearance-model-24824/)) : tones appear flatter.

Using a dark interface to retouch photos can therefore lead to excessive retouching (abuse of contrast and saturation) and to a photo that is too dark once printed. The introduction of the grey theme avoids these illusions and consequences on image processing.

The four main themes no longer display icons of the darkroom modules to lighten the interface and limit colorful visual distractions. As some users have requested them, specific variants add the display of the icons of these modules. If you want these icons, use the _icons_ themes instead.

_Here it's the new darkroom view with dark theme (without icons):_

![dark theme without icons](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/darkthemewithouticons.png)

_And same view, with modules icons:_

![dark theme with icons](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/darkthemewithicons.png)

## Other improvements about that new GUI

### darkroom view

New shortcuts have been added for a better user experience and more image space. Here are the most important ones in the darkroom (the first 4 shortcuts are also usable in other darktable views):

- `Shift+Ctrl+t`: show/hide top panel (between the image and the top banner)
- `Shift+Ctrl+l`: same for left panel
- `Shift+Ctrl+r`: same for right one
- `Shift+Ctrl+b`: same for bottom one (between the image and the image banner)
- `Shift+Ctrl+h`: same for histogram
- `Shift+Ctrl+n`: same for thumbnail image on the left

These shortcuts are a good complement to this two shortcuts already present in darktable:

- `Ctrl+f`: show/hide images banner at the bottom, without going to the options
- `Ctrl+h`: same for top banner (from logo to links to lighttable, darkroom, others)

These shortcuts can be easily memorized by understanding this: the letters correspond to the 1st letter of the English term (top, left, right, bottom, histogram, navigation, filmstrip, header).

And finally, valid in all darktable views: my favorite to use only once, after getting used on using the shortcuts above: `b`. With this simple letter, just say goodbye to borders with arrows. And darktable is getting lighter! Take a look at the screenshots below to see for yourself.
On the image below, the applied shortcuts have been: `b`, `Shift+Ctrl+l`, `Shift+Ctrl+t`, `Shift+Ctrl+b` (for these last three ones, a quick tip: keep pressing `Shift+Ctrl` and then successively press `l`, `t` and `b` to hide the left, top and bottom panels) and `Ctrl+f` (for the image banner removed at the bottom). To replace the removed parts, simply repeat the same shortcuts.

![light version for image editing](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/cnlightwithoutborders.png)

With all these shortcuts, you can display your darkroom view with the parts you want (with or without miniature, right or left panel, histogram or not...). Test, see what suits you best for your practice, depending on your need or when you want to alternate between the parts. It's simple and effective!

**_Search module field_**

In this darkroom view, you could see on above screen capture, a new search module field, just between modules tabs and modules list. This new field simply allow to... search a module among all those darktable have (search to be done in lowercase, the field is case sensitive).

**_Nouvelle visualisation des options de masque_**

In the modules allowing the use of fusion masks, access to mask options is no longer via a drop-down menu, and has become more visual. Just see yourself:

![masks module options](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/masks.png)

From left to right: _"disable active mask"_, _"uniform mask"_, _"drawn mask"_, _"parametric mask"_, _"drawn & parametric mask"_ et _"raster mask"_ (new one we will talk about later in this article).

**_History_**

A redesign of the history has been done. darktable, like any RAW developer software, must run some default modules to allow the RAW to be displayed. Previously these modules were hidden. For greater transparency, all the processing steps performed are now displayed, even if they do not correspond to an existing module, such as the _gamma_ line. These modules cannot be disabled because of their usefulness.

As you can see below, new visual icons have appeared on the right. They indicate the status of the module (for the first three states, you will also find this same visual in the module panel on the right):

- Default modules that cannot be disabled: _full round surrounded by a circle_ (ex: _gamma_)
- Modules in active state (that could be disable): on/off button enabled_ (ex: _white balance_)
- Modules in the state disabled (that could be enabled) : on/off button disabled and the text of the module in light grey (ex: _base curve_)
- Deprecated modules (recommended not to use them anymore): _cross_ (ex: _filmic_). If enabled, white and light grey text and light grey if disabled.

![history](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/history.png)

**_EXIF images infos_**

For a better rendering of the histogram, as well as for a better visualization of the main EXIF data of the image, the latter have been removed from the histogram. They are now visible in a new area, by default at the bottom of the image:

![EXIF images infos](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/imageinfosline.png)

It is possible to customize the data displayed in this area, in the darktable preferences (see the "format of the image information line" line) as well as the position of this information line:

![EXIF infos settings](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/prefsinfoimage.png)

Possible parameters for the format can be found in darktable manual. Changing these options requires a restart of the application to be taken into account.

**_Second image preview window_**

It is now possible to display a second image preview window via the dual screen icon at the left bottom of darkroom image. This view allows you to select a different display profile from the main view for comparison. To do this, simply select it via a new menu accessible in the usual softproofing and gamut verification options, at the bottom right of the image in the main view.

You can zoom in this new view, via the mouse wheel.

![2nd image preview window](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/2window.png)

This new window has its own color profile, which allows you to place it on another screen and use its dedicated profile. As for the main window, the profile is automatically retrieved by darktable via colord or xatom, but it is possible to add it manually in `~/.config/darktable/color/out` and then select it from the display profile menu. Note that colord does not seem to work under Windows with a second screen, so Windows users will have to perform the operation manually.

### Accels window : viewing shortcuts in the active view

At any time, whatever the active view of darktable, you can display the shortcuts that can be used in this view. This list of shortcuts is dynamic and includes both default shortcuts and your custom ones. To display it, nothing could be easier: press the letter `h` (then `Alt` if you want to leave this panel active) It is possible to separate it from the darktable window via the button that appears at the top right).

![accels window](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/shortcutshelp.png)

### Preferences

darktable 3.0 also offers a clearer arrangement of preferences. The options are now grouped into sections to make it easier to find and customize preferences.

## New lighttable features: *culling* and *timeline* views

The lighttable is now more reactive. Many code optimizations have been performed to greatly improve usage and performance.

The lighttable also sees the arrival of undo/redo functions via `Ctrl+Z` shortcut applicable to keywords, star rating, color labels, metadata modification, copy/paste or removal history or even style application.
=> Since this shortcut was initially assigned to the preview with focus detection, this last function can now be displayed via the shortcut `Ctrl+W`. For consistency, the preview previously displayed with `Z` is now displayed via the shortcut `W` or `Alt+W` (persistent preview).

It is now possible to zoom on an image in preview mode. After launching the preview, use the shortcut `Ctrl+mouse wheel` to zoom in/out. However, in some smaller configurations, the new zoom capabilities may result in a waiting time to allow the zoomed image to be displayed. To speed up this display, it may be useful to run the following command in terminal mode (darktable must be closed, and remain closed, while executing this command):

    darktable-generate-cache -m 6

It is possible to modify the number according to the desired zoom level (7 corresponding to 100% level and lower). 5 can be a good compromise disk space saving. Indeed, this command generates a cache folder containing jpg files corresponding to the active histories at the execution time of this command.

### *culling* view

The lighttable gives until now two modes : _zoomable light table_ and _file manager_. A third mode appears, and not the least : a _culling_ mode. This mode displays a consecutive (or not) and fixed number of images from the selected one. It allows to zoom and pan on them. Images number can be fixed by the user, and it's possible to move on with mouse wheel and keyboard.

Yes, you understand, one of the most frequently requested features of the lighttable is finally there : possibility to compare images. See now when it works !

Two options exist:

- _fixed zoom_ : images number is set by a cursor on the right of culling selector menu (launching shortcut of this mode: `x`)
- _dynamic zoom_ : images number is set by images selected on lighttable (launching shortcut of this mode: `Ctrl+X`)

Of course, here, dynamic zoom will have same effect as fixed one if selected number is the one set on fixed zoom mode. In both cases, you can move on images of the actual collection simply with:

- `Wheel mouse` (or keyboard `left and righ arrows`) : to display previsous or next images.

The number of images to be displayed and the mode option are set in the selection mode with settings on the right of the culling menu at the bottom of the lighttable:

![culling mode](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/culling.png)

If, as here, the number of images to be displayed, defined in this mode, is 2 (fixed zoom), selecting an image will display that image and the next one. This gives us (reminder : mode launched via `x` shortcut):

![fixed zoom](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/cullingfixe.png)

Note here that I have hidden all the panels with the shortcuts seen above, to better benefit from the display of images and comparison possibilities. To display the settings of the selection mode (previous image), just type shortcut `Shift+Ctrl+b`.

And the same, on six selected images, in dynamic range mode (mode lauched with `Ctrl+x`):

![dynamic zoom](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/cullingdynamic.png)

In this culling mode, whether in fixed zoom or dynamic zoom, here are the options available to you:

- `Ctrl+wheel mouse` : zoom in displayed images.
- `Shift+Ctrl+wheel mouse` : zoom only on the image where the cursor is hover.
- `Click & drag` : on a zoomed imaged, allow to pan on the image (will apply on all displayed images at the same time).
- `Shift+Click & drag` : same as above but only on the image where the cursor is hover.

**Warning :** _Although it is possible to display more than 4 images, zoom and pan within images are only available for up to 4 images, for visual comfort and performance reasons._

As you can see, the culling mode also displays the main image information, rating stars and color labels. It is of course possible, as in other modes, to define them in this mode.

An important trick to know: you can simply show or hide these informations depending on the position of your cursor. Point the cursor upwards in an image to make them appear, slide it downwards to make them disappear. 

### *timeline* view

_timeline_ view is a new view displayed on the bottom of lighttable with `Ctrl+f` shortcut (same shortcut as filmstrip in darkroom view, this new view is displayed on same place but in lighttable view). This view could also be activated or disable on preferences window.

This view display a chronological timeline of your images and allow to select a wanted range with a simple click & drag with your mouse. You just have to move your cursor on a part of this view to see the period (displayed in year/month).

You could see a preview of this timeline view on the four themes images in the beginning of this article.

## A workflow that extends over the RGB space :

De nouveaux modules apparaissent, exclusivement en espace RVB. Avec darktable 3.0, vous pouvez donc éditer vos images entièrement en RVB avec les modules qui vont vous être présentés dans cette partie : la très grande majorité des images peuvent être traitées exclusivement avec ces modules, combinés avec les modules de _balance des blancs_, _exposition_ et _réduction de bruit (profil)_. Un workflow puissant et rapide, avec moins de modules. En un mot : efficace.

=> Pour une utilisation optimale de ce nouveau workflow, il est fortement recommandé d'activer, dans le module _profil de couleur d'entrée_, le profil de travail **RVB Rec2020 linéaire** (voire si besoin l'espace **prophoto RVB linéaire**).
=> Il est également vivement recommandé dans ce cadre de désactiver les modules _courbe de base_ et _renforcer la netteté_ via les 3 nouvelles options des _préférences_ de darktable, onglet _fonctionnement_ puis rubrique _qualité_

Pour comprendre ce workflow RGB linéaire et pourquoi il est adopté dans darktable, nous vous conseillons de regarder la vidéo suivante : https://www.youtube.com/watch?v=3FFU-Ltvm0I. De manière générale, prendre le temps de visionner les dernières vidéos d'Aurélien Pierre sur cette version 3.0 (activer les sous-titres) vous aidera à devenir plus efficace dans le traitement de vos images, vous permettant de tirer le meilleur parti de ce nouveau workflow et, au final, gagner progressivement beaucoup de temps.

Un résumé présentant ce workflow et ses avantages est néanmoins proposé ci-dessous.

Le workflow RGB linéaire introduit progressivement depuis darktable 2.6 avec _filmique_ et la _balance couleur_ permet de s'affranchir de l'héritage graphique des années 1980-1990 centré sur la photographie à basse plage dynamique destinée à l'impression papier. Ce workflow traditionnel, dit « relatif à l'affichage » (_display-referred_), postule que les valeurs RGB encodent des couleurs (au sens perceptuel) et les manipule de façon psychologiquement réaliste. Malheureusement, les modèles psychophysiques qui relient la lumière (physique) à la sensation colorée (psychologique) ne sont valides que pour des images à faible contraste (ou faible plage dynamique), de l'ordre de 100:1 (6,67 EV), ce qui pose des problèmes croissants à mesure que les appareils photo modernes voient leur plage dynamique augmenter (actuellement entre 12 et 14 EV, soit 4096:1 à 16384:1). À prévoir si vous souhaitez pousser vos basses lumières : virages de teintes parasites et problèmes de sur- ou de sous-saturation, couleur qui explose quand on corrige la luminance, luminance qui explose quand on corrige la couleur… L'enfer.

Le workflow RGB linéaire, dit « relatif à la scène » (_scene-referred_) postule que les valeurs RGB encodent des émissions lumineuses, soit un spectre lumineux réduit à 3 intensités à travers le capteur de l'appareil photo, qui n'est autre qu'un colorimètre. Il manipule les valeurs RGB de façon physiquement réaliste, en reproduisant numériquement l'effet de filtres optiques. Ceci permet non seulement de s'accommoder de n'importe quelle plage dynamique, sans avoir à changer d'algorithmes (donc plus de traitement HDR spécifique), mais aussi d'obtenir des résultats plus naturels et plus prévisibles.

Ce nouveau workflow – bien que déjà adopté par l'industrie cinématographique depuis les années 1990, par nécessité pratique – fait encore office de bête curieuse en photographie, et va changer les habitudes des utilisateurs qui vont devoir raisonner de plus en plus en terme de lumière (physique) et de moins en moins en terme de couleur (psychologique et perceptuelle). 

Il n'y a pourtant pas à s'inquiéter : un enfant qui peint sur une feuille manipule la couleur de façon physiquement réaliste, sans même s'en rendre compte. Il sait qu'ajouter du bleu et du jaune donnera du vert (notez que la peinture est une synthèse soustractive). Pour autant, si l'on essaie de soustraire du bleu et du jaune à partir du blanc, dans un logiciel de dessin qui travaille dans un espace relatif à l'affichage (comme Gimp), on obtient du noir. Si l'on essaie d'additionner bleu et jaune, on obtient du blanc. Il faudra passer par Krita, et son mode de peinture linéaire, pour qu'additionner jaune et bleu donne un « genre de vert » (qui tire plutôt sur le cyan). Ceci suffit à prouver l'intuitivité du workflow RGB linéaire physiquement réaliste, quand bien même on évacue la perception colorée de l'équation.

### New *filmic RGB* module

_Filmique RVB_ est la nouvelle version de _filmique_ (tout court), réécrit pour la nouvelle API interne permettant à l'utilisateur de définir un espace de couleur RVB pour le pipeline (à régler dans le module _profil de couleur d'entrée_, comme expliqué un peu plus tôt). Comme la version précédente, son objectif est d'opérer une transformation des valeurs RGB, depuis l'espace de la scène photographiée (potentiellement à haute plage dynamique) vers l'espace de l'écran (à faible plage dynamique), en définissant une intention pour la préservation du contraste dans les tons moyens (à l'intérieur de la latitude). Il peut donc travailler aussi bien en compression ou en dilatation de la plage dynamique, ou même en gardant la plage dynamique identique, en lieu et place d'une courbe de tonalité en « S ».

Au passage, quelques bugs ont été réglés, comme la sur-saturation (notamment dans les rouges) causée par le mode de préservation de la chrominance, et plusieurs changements ont été opérés pour améliorer l'ergonomie :

1. Les contrôles sont découpés en onglets scène/apparence/affichage, plus clairs et moins hauts à l'écran.
1. La courbe filmique est une nouvelle spline créée sur mesure pour reproduire le comportement des courbes densitométriques de la pellicule. Elle offre des noirs plus profonds et moins délavés que la précédente version, un meilleur contraste local dans les tons moyens, et n'oscille jamais, peu importe les paramètres.
1. La fonction de transfert de l'espace de sortie s'ajuste automatiquement pour garder le point gris sur la ligne identité, et permet un meilleur contrôle de la courbe. 
1. La latitude est définie en pourcentage de la plage dynamique, et n'a plus besoin d'être ajustée si les expositions relatives du blanc et du noir ont été modifiées.
1. La courbe de désaturation est affichée sur le graphe.
1. Le réglage de saturation globale, implanté pour corriger les effets du bug de préservation de la chrominance, est supprimé. L'utilisation de la saturation dans la balance couleur est recommandée.

![filmic RVB](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/filmicrvb.png)

Deux nouveaux modes de préservation de la chrominance ont été ajoutés en plus de l'ancien (max RVB) : luminance Y et norme puissance. Ils permettront de s'adapter à différents scénarios, par exemple lorsque le mode max RVB assombrit trop les ciels bleus.

### New *tone equalizer* module

L'_égaliseur de tons_ reprend les fonctionnalités de _mappage des tonalités_ et des _courbes_, mais les adapte à une représentation logarithmique de la luminosité (en IL/EV) conforme au _zone system_ d'Ansel Adams. Sa fonction est simplement de définir une compensation d'exposition paramétrique, qui varie suivant la luminosité originale des pixels. Il est possible de reproduire entièrement le fonctionnement de _l'égaliseur de tons_ en utilisant plusieurs instances du module _exposition_ fusionnées en mode paramétrique et réglées pour isoler différents niveaux d'exposition. L'_égaliseur de tons_ permet uniquement d'accélérer le procédé, et d'en automatiser certaines parties. 

Il offre une interface qui permet de définir très rapidement une compensation d'exposition sélective pour chaque bande d'exposition entre 0 EV (blanc) et -8 EV (noir), à la manière des égaliseurs audio des amplis hifi. La correction d'exposition réalise une extraction de contenu par filtre guidé, permettant d'appliquer la même correction sur des aires continues de l'image, et donc de préserver le contraste local (la logique est similaire au module _ombres et hautes lumières_ mais le filtre guidé est conçu pour ne jamais produire de halos sur les bords contrastés). L'_égaliseur de tons_ permet donc de ré-éclairer la scène à posteriori mais de façon physiquement réaliste, sans affecter la chrominance ni créer de halos, et donc beaucoup plus crédible que les outils classiques de mappage HDR ou de correction des ombres. 

Il innove également sur l'interaction utilisateur, en proposant un curseur interactif qui permet, au survol de l'image, d'afficher l'exposition de la zone sous le curseur et de régler directement la correction d'exposition correspondante via la `molette souris`.

![tone equalizer](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/toneequalizer.png)

Le mode de préservation des détails (basé sur le filtre guidé) peut être désactivé, auquel cas le module se comporte comme une simple courbe de tonalité avec une interface logarithmique et un algorithme qui préserve la chrominance. L'interpolation des réglages utilisant une série de gaussiennes, elle sera alors plus lisse que l'interpolation par spline monotone et moins oscillante que l'interpolation par splines cubiques des modules *courbes de base* et *courbe des tonalités*.

### New *rgb curve* and *rgb levels* modules

Ces deux modules reprennent les fonctionnalités des anciens *niveaux* et *courbes de tonalités* (utilisé en mode RVB), mais travaillent dans l'espace RVB du pipeline et utilisent des modes de fusion en RVB linéaire (noter que les anciens modules fusionnent en Lab). Ils permettent en outre de gérer les canaux RVB séparément, et d'utiliser la même logique de préservation de la chrominance que filmique en mode canaux joints.

Il est utile de noter que le module *niveaux RVB* utilise exactement le même algorithme que le module *balance couleur* en mode slope, offset, power : le réglage noir correspond au réglage offset, le gris au power, et le blanc au slope. C'est essentiellement l'interface qui change, et le fait que *niveaux RVB* suppose des valeurs d'entrées entre 0 % et 100 % et précalcule une LUT 16 bits pour la transformation à appliquer (technique utilisée il y a 10 ans pour accélérer le traitement, moins utile aujourd'hui), alors que *balance couleur* accepte des valeurs entre 0 et l'infini et calcule directement la valeur exacte des pixels.

## Major improvements on noise reduction

Several improvements have been made regarding denoise profiled to improve denoising quality and to make user's life easier.

### Context: how does denoise profiled work

Noise is a quantum phenomenon that generates incoherent RGB values for certain pixels randomly and that is perceived as luminous or coloured "grain" that scatter the image where one would expect smooth surfaces. As is often the case in science, when faced with a random phenomenon, we deal with it through the law of large numbers by seeking a statistical distribution that models the random phenomenon, of which two essential parameters are the mean and the variance.

Variance is a measure of the dispersion of values around the mean, so in our case it gives information on the typical deviation between the mean and a "normal" pixel. The profile allows the variance to be expressed as a function of the mean.

A profile is a set of a few parameters (2 per channel and per ISO value in our case) that describe the way the noise variance change depending on luminosity. It is built using measurements done on test images (that are blurry to be sure that anything that isn't blurred is noise).

Denoising algorithms are usually made with the assumption that variance does not depend on luminosity. Applying them on data where this hypothesis is not verified gives uneven smoothing of the noise. The profile allows to define a transformation on the image, called a variance stabilization transform (VST), that produces an image where the variance of the noise becomes constant: after the tranform the noise in dark and light areas then has the same characteristics, and the denoising algorithm can do its job much more easily.

### New features in denoise profiled to improve noise reduction quality

We have seen that darktable uses two parameters for each channel and ISO value to perform its variance stabilization transform.

An important change introduced was to change the variance stabilization transform to make it more generic. The new variance stabilization transform admits a 3rd parameter allowing to control the amount of denoising on shadows highlights, which helps finding a good balance.
Ideally, this parameter should be determined during profiling, but for the moment it is automatically inferred with a heuristic from the 2 known parameters of the profile. It can also be modified manually in the interface.
Note that this parameter corresponds to the gamma parameter present in the Rawtherapee noise reduction.
This change in variance stabilization transform also provided an opportunity to introduce a bias reduction parameter, which corrects the image when shadows turn purple (which happens regularly at high ISOs).

Several new parameters have also been added to the non-local means algorithm.

The first parameter added is the scattering parameter, which allows to effectively reduce coarse-grained noise.
A small example on a picture of jpg54, with what we used to get (on the left), and what we can get now (on the right).
We see that the noise reduction on the left creates a very ugly coarse-grained noise.

![Impact of scattering parameter](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/nlmeans-scatter.jpg)

Another parameter called “central pixel weight” was added. It mainly controls the details: it allows to recover details (and fine grain noise). When set to high values, the module mainly reduces chrominance noise. **This method is the adviced method if you want to reduce mostly chroma noise.** An example, deliberately a little overdone, with no detail recovery at the top, and a strong detail recovery at the bottom:

![Impact of central pixel weight](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/nlmeans-details.jpg)

### New features in denoise profiled to improve the user experience

The addition of these new parameters gives a rather complex interface, with many parameters:

![Denoise profiled's interface](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/noiseparameters.jpg)

An "auto" mode has thus been added, which sets the vast majority of parameters on its own based on the profile. This mode has a slider to adjust the proposed automatic setting. Increase the value of this slider if the denoising is unsatisfactory, reduce it if the local contrast is smoothed too much.
This setting should be used especially if you have under-exposed your image significantly.

![Denoise profiled's auto mode](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/noisenlmauto.jpg)

If you change the values in this mode and return to a manual mode, the sliders will be updated, as if you had changed them directly.

In addition, the module’s default settings are also automatically adjusted according to the profile, allowing a one-click noise reduction activating the module.

## Other important features

### new _3D Lut_ module

Le module _3D lut_ a été introduit, il permet d’appliquer des matrices 3D à une photo. Ces matrices permettent au module de convertir une valeur RVB dans une autre valeur RVB (pour le N/B, toutes les valeurs RVB en valeur de gris, noirs et blancs). Ils sont utilisés pour simuler des films argentiques ou pour créer des univers colorés. Ce module reprend feu le module _HaldCLut_.

_3D lut_ utilise 3 types de matrices : les fichiers .cube, les HaldCLut .png et les LUT compressés.

- Les fichiers .cube sont des fichiers texte très utilisés en vidéo et par les coloristes. 
- Les fichiers HaldCLut .png sont des fichiers image. Ils sont plus petits que les fichiers .cube.

**Attention :** _Ces 2 types de fichier (.cube et .png) étant trop volumineux, ils ne sont enregistrés ni dans la base de données de darktable ni dans les fichiers .xmp ; seul le répertoire et le nom du fichier est enregistré. Cela rend plus difficile l'échange de traitement utilisant 3D Lut et la pérennité d'un traitement l'utilisant, en cas de perte de ces fichiers.**
Pour qu'un autre utilisateur puisse refaire le traitement, il faudra lui fournir le fichier (.cube ou .png) avec le fichier RAW et le .xmp sans l'application de 3d Lut car le lien sera différent. Ce correspondant devra appliquer le module au répertoire de Lut sur sa machine et à son système d'exploitation._

• Les fichiers LUT compressés sont des fichiers image .png compressés avec des routines proposées par G’Mic. Leur taille permet de les inclure dans la base de données et les .xmp, donc de les récupérer et les transmettre plus facilement à un autre utilisateur. 
Vous pouvez télécharger [des HaldClut .png qui simulent des films argentques](http://www.quelsolaar.com/technology/download.html) et [des fichiers .cube ](https://www.on1.com/free/luts/?fbclid=IwAR11-LyGrHDpeho_mrwUqKgPpFvgYeye-ed-auxF8nGzHoI0w35ZcESoX8Q)

Vous trouverez également [l'article en anglais](https://www.darktable.org/2019/05/New%20module-lut3d/), il donne aussi des liens vers des fichiers Lut.

**Comment utiliser _3D lut_ :**

- Définir un répertoire à utiliser dans les préférences à la fin de l’onglet _fonctionnement_

![lut folder](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/3dLut.png)

- RDV dans la chambre noire et cliquer sur l'icône dans le module _3D Lut_

![open lut folder](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/3dLutSelRep.png)

- L’ouverture des fichiers ne présente que les fichiers « .png », il faut donc sélectionner « .cube » ou « tous les fichiers » :

![.cube et .png file selection](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/3dLutSelfile.png)

- Vous obtenez avec un .png N/B :

![apply .png black and white Lut](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/3dLutpng.png)

- et avec un .cube de couleur :

![apply .cube color Lut](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/3dLutcube.png)

Pour l’espace couleur, utilisez sRBG avec les .png et REC.709 pour les .cube.

La méthode d’interpolation « tétraédrique » convient dans la grande majorité des cas et il est rare que l’on voit la différence avec les 2 autres méthodes (sauf parfois avec des tables de conversion de petite taille).

### Complete rework of tagging module

Le module mots-clés, présent en chambre noire et en table lumineuse a fait l'objet d'une refonte complète. Son utilisation est beaucoup plus intuitive qu'avant. De nombreuses fonctions qui nécessitaient auparavant des manipulations compliquées sont maintenant accessibles en un ou deux clics. L'aspect général n’a pas changé fondamentalement : deux fenêtres superposées, celle du haut présentant les mots-clés attachés aux images sélectionnées, celle du bas affichant le dictionnaire des mots clés disponibles dans darktable. Entre les deux, une zone de saisie. La comparaison avant/maintenant s’arrête là car le contenu des fenêtres a bien changé et surtout les manipulations sont beaucoup plus intuitives et mieux encadrées.

![tagging module](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/tagging.png)

La fenêtre du haut (mots-clés attachés) présente toujours la liste des mots clés attachés à la sélection courante. Ces mots clés sont toujours présentés par ligne selon la notation propre à darktable (les niveaux de hiérarchie sont séparés par des barres verticales, ‘|’ pipe en langage informatique). Là s’arrêtent les similitudes.

À gauche de chaque mot-clé se trouve maintenant une petite icône qui peut avoir trois aspects : soit rien du tout, soit un tiret, soit une coche.

* Rien du tout : il s’agit d’une image survolée, mais non sélectionnée.
* Un tiret : le mot clé est attaché à au moins une des images sélectionnées.
* Une coche : le mot clé est attaché à toutes les images sélectionnées.

À droite des mots clés, entre parenthèses s’affiche le nombre d’images indexées par ce mot clé dans la sélection courante.

**Grosse nouveauté :** un clic droit sur un mot clé affiche un menu contextuel contenant un ou deux items.

Un item :

* _détacher le mot-clé_ - fait exactement ce qu’il dit !

Deux items :

* _attache le mot-clé à toutes les images sélectionnées_ - Si vous avez sélectionné une série d’images contenant des mots clés différents, cet item permet d’attacher le mot-clé à l’ensemble des images sélectionnées ; celles qui étaient déjà étiquetées le restent, mais celles qui ne l’étaient pas le deviennent. Très pratique !
* _détacher le mot-clé_ - Comme ci-dessus.

En bas de la fenêtre, le nombre de boutons est passé de deux à cinq, Outre les boutons __`attacher`__ et __`détacher`__ déjà connus, trois autres apparaissent :

* __`✓`__ permet d’activer ou non l’affichage des mots clés spécifiques à darktable, ce qui allège considérablement la présentation.
* __`⥮`__ permet de modifier le classement des mots clés dans la fenêtre, soit en ordre alphabétique, soit en fonction du nombre d’images étiquetées.
* __`―`__ ce dernier enfin permet d’afficher la hiérarchie de chaque mot clé ou juste le mot-clé terminal.

La zone de saisie  médiane permet toujours de rechercher des mots-clés ou d’en créer de nouveaux. Cependant, pour la création, on aura avantage à utiliser la nouvelle fenêtre dédiée, car elle permet plus de choses (voir ci-dessous). Enfin, un bouton à droite permet de la vider facilement (image).

La fenêtre du bas (dictionnaire des mots-clés) présente toujours la liste des mots clés disponibles. Grosse amélioration à nouveau, cela concerne cette fois la lisibilité : les hiérarchies de mots-clés sont présentées sous forme arborescente ! De la même façon que le sont les mots clés dans le module filtre de collection ou les styles hiérarchisés dans le module styles. Comme dans la fenêtre des mots clés attachés, à gauche  peut apparaître une des mêmes petites icônes. Leur signification est la suivante :

* Rien du tout : il s’agit d’un mot clé disponible mais non utilisé par les photos sélectionnées actuellement.
* Un tiret : désigne une hiérarchie contenant au moins un mot-clé attaché à une des images sélectionnées.
* Une coche : le mot clé est attaché à l’une des images sélectionnées. À droite des mots clés, entre parenthèses s’affiche le nombre total d’images étiquetées par ce mot clé.

À droite des mots clés, entre parenthèses, s’affiche le nombre d’images indexées par ce mot clé dans TOUT le dictionnaire, ou rien du tout s'il n'y a aucune image attachée à ce mot-clé.

Encore une grosse nouveauté ! Comme dans la fenêtre des mots clés attachés, un menu contextuel très complet est également accessible par clic droit :

* _attacher le mot-clé_ - Fait exactement ce qu’il dit...
* _détacher le mot-clé_ - Idem
* _supprimer le mot-clé_ - Idem  avec confirmation !
* _supprimer la branche_ - Supprime un mot clé et tous les élément hiérarchiques de niveau supérieurs s’ils ne sont plus utilisés par aucune autre image.
* _créer un mot clé_ - Ouvre un dialogue pour la création de mots clés. Il est bien sûr toujours possible de créer un mot clé avec la ligne de saisie et le bouton nouveau, mais la création via  cet item permet plus de choses. Le mot clé peut en effet maintenant être défini ici comme privé. Il ne sera donc pas inclus dans les images exportées. Il reçoit également une information de catégorie. (rien trouvé là dessus). Enfin on peut lui adjoindre un synonyme qui facilitera la saisie pour des mots clés souvent utilisés.
* _éditer (modifier) le mot clé_ - Permet la modification du mot clé et de ses attributs décrits ci-dessus.
* _renommer un chemin (modifier la branche)_ - Permet de modifier les mots-clés intermédiaires dans une hiérarchie.
* _copier le mot clé_ - Permet d’ajouter le mot clé dans la zone de saisie pour faciliter la recherche ou la création.

Auquel s’ajoute, si le mot clé est attaché à au moins une image :

* _aller à la collection liée (indexée) par le mot clé_ - qui recopie le mot clé dans le module filtre de collection et active cette collection. Génial !!!

Les boutons situés sous la fenêtre dictionnaire sont également passés de quatre à cinq.
Précédemment les quatre boutons étaient : __`nouveau`__, __`supprimer`__, __`importer`__ et __`exporter`__

Maintenant les boutons sont :

* __`nouveau`__ - fonctionne comme auparavant (pour la création de mots clés, voir la remarque relative à l’item « créer... » dans la description du menu contextuel ci-dessus)
* __`importer`__ - fonctionne comme auparavant.
* __`exporter`__ - fonctionne comme auparavant.
* __`＋`__ Active/désactive les suggestions. N’est accessible que si le bouton suivant est en mode liste.
* __`≣`__ Passe de la vue liste à la vue arbre. Permet de retrouver l’affichage ancien avec les hiérarchies sous forme de ligne séparées par des pipes (|)

Comme avant il est toujours possible d’attacher/détacher des mots-clés en double-cliquant.

Enfin et surtout, les deux fenêtres sont maintenant redimensionnables ! Il suffit de faire un `Ctrl` + `molette` pour agrandir ou réduire chaque fenêtre individuellement. Ce qui permet très facilement d’utiliser toute la colonne de droite pour gérer confortablement ses mots-clés, ou de ramener chaque fenêtre à une dimension minimum pour avoir toujours ses mots-clés sous la main tout en ayant un autre module déployé.

### New _basic adjustments_ module

_ajustements de base_ permet, comme son nom l'indique, des ajustements de base, sur des options essentielles en un seul module. Pour l'utilisation de ce module ainsi que les masques raster, j'ai choisi un RAW proposé au traitement par [@holly76](https://forums.darktable.fr/showthread.php?tid=3930).

Ce module utilise les 2 principaux curseurs d'exposition :

![Exposition](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/basicadjustmentsexposition.png)

Les 3 curseurs de _contraste_, _luminosité_ et _saturation_ :

![](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/basicadjustmentsC_L_S.png)

**Attention :** 
Il ne faut pas utiliser _ajustements de base_ avec les modules _exposition_ et _contraste lum. saturation_. Effectivement cela reviendrait à créer une seconde instance du module sans masque :
_preserver couleur_ utilise les mêmes valeurs que dans _courbe de base_ (options ajoutées également dans ce module sur darktable 3.0). Il est donc préférable de ne pas utiliser ces 2 options en même temps et même d'utiliser ces 2 modules en même temps.

**Un exemple de traitement :**

J'ai choisi cette photo largement sous-exposée. J'utilise la pipette avec une zone qui me semble représenter une zone correctement exposée :

![selection zone en français](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/basicadjustmentspicker.png) 

les curseurs sont ajustés pour traiter cette photo :

![photo corrigée en français](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/basicadjustmentscorrection.png)

L'utilisation de ce module permet de corriger rapidement une photo qui ne demande pas trop de traitement. Il est donc particulièrement adapté pour un traitement simple et rapide, ou pour débuter le traitement RAW (comme montré dans cet exemple). La limite principale de ce module étant que ces différents paramètres interviennent habituellement (via les différents modules les proposant par ailleurs) à différents niveaux du traitement de l'image, n'apportant donc pas tout à fait le même rendu.

**=> Il ne doit pas être utilisable avec le nouveau workflow RVB que propose la trilogie : _filmique rvb_, _balance couleur_ et _égaliseur de ton_ auquel s'ajoute en fonction des besoins : _courbe rvb_ et _niveaux rvb_.**

### New _raster mask_

Les masques raster ajoutent un nouveau mode qui permet de réutiliser un masque paramétrique d'un module dans un autre module. 

**Warning :** _le masque raster peut reprendre uniquement un masque d'un module le précédant dans la chaîne de traitement. Il faut également être vigilant à ne pas déplacer un module utilisant un masque raster, avant le module du masque d'origine. Ceci pouvant entraîner des effets indésirables (dans le pire des cas, un crash de darktable)._

J'ai repris la photo si dessus pour cet exemple. J'ai commencé par faire un masque paramétrique sur les ombres avec le module exposition :
![Masque paramétrique de départ](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/M_raster1.png)

puis d'éclairer les ombres :
![Éclaire les ombres](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/M_raster2.png)

Ensuite, pour donner un peu de peps aux ombres dans les verts, j'ai utilisé le même masque dans zone de couleurs avec masque raster. Il suffit pour cela de simplement sélectionner l'option masque raster puis de choisir le masque raster _exposition_ :
![Masque raster](https://raw.githubusercontent.com/Nilvus/dtorg/master/content/blog/2019-12-24-darktable-3.0/en/M_raster3.png)

# Other improvements

The image processing chain (pipeline) has been thoroughly reviewed and optimized. It is now possible to re-order the modules via a `Shift+Ctrl+Drag&Drop` of these modules in the darkroom or via the instance menu and the up/down options.
**WARNING:** _It is VERY IMPORTANT TO UNDERSTAND that moving the modules changes the order in which they are processed, so it affects the rendering of the current image. The default order is safe and optimized for the majority of uses. It is recommended to move a module only if you know what you are doing and what effect it will have on your image. Under no circumstances should this change be used to "classify" these modules.

The _colored areas_ module now displays a histogram based on the "select by" option. It is now possible to add and remove nodes to the curve, but these nodes can still be moved with the old size control by checking the edit by area box. There is also a new "pronounced" processing option and a new picker that allows you to create a curve based on the selected image area.

Some performance and visual improvements are also to be highlighted on the _color picker_ (left panel of the darkroom) and _tone curve_ modules. More generally, many improvements have been made around the selection picker in various darktable locations.

A new preference option allows you to develop or fold a darkroom module automatically as soon as it is activated or deactivated.

The original export to Picasa has been updated to Google Photos.

darktable 3.0 also brings many bug fixes and some other minor improvements probably forgotten here due to this so rich new version in new features.

# A 3.0.1 release already on its way

Due to the important changes made by version 3.0, a feature freez was decided at the beginning of October and new text strings were frozen at the beginning of November. This had allow both time to fix as many bugs as possible and to translators the possibility to offer their translations for darktable 3.0 release on Christmas.

Thus, since then, new improvements have already been proposed or are under development. They should be published for 3.0.1, release expected in the first quarter of 2020. Here are some of the main new features expected for this 3.0.1:

- A metadata copying functionality between images (keywords, geolocation, notation, color labels...)
- Added the possibility to search for several keywords in the collections search field, separated by a simple comma.
- Different module optimizations: _tone equalizer_, _color zones_...
- Adding a vibrance slider in _basic adjustments_ module
- A significant improvement in the transition from displaying a darkroom image, loaded from the light table (no more weird background display of a part of the light table before the full display of the darkroom image)
- A focus peaking feature (with 3 display levels at the time of writing) that can be activated in both lighttable and darkroom views. This significantly improves the display of sharpness areas of an image, compared to the "focus detection rectangles" of the currently available lighttable view (this mode will remain available).
- The possibility to resize directly and independently, with the mouse, the left and right panels. The size of each panel (left and right) will be stored for each view. It will therefore be possible to have a different size for each panel, and for each view.
- The possible addition of a white frame around the image, in darkroom view, according to ISO 12646:2008 ICC recommendation. This allows you to visualize the rendering of an image, especially for use at the end of exposure. Be careful, this is a specific use, so the recommendation and practice requires a white frame. Any other colour would render the interest of this option obsolete.
- More precise adjustment of dark tones for parametric masks (logarithmic mode)
- Re-apply the last keyword to one or more images with a simple keyboard key
- And some other improvements planned, as well as the usual bug fixes.

This list is not exhaustive and presents the main developments known to date.

# About this article

This article is licensed under the terms of the [Attribution 2.0 Generic (CC BY 2.0)](https://creativecommons.org/licenses/by/2.0/), or, at your option, the [Creative Commons BY-NC-SA 3.0 License](https://creativecommons.org/licenses/by-nc-sa/3.0/).

**Contributors:**
[Nilvus](https://github.com/Nilvus), [jpg54](https://www.flickr.com/photos/113336874@N07/), Ro_G, [aurelienpierre](https://aurelienpierre.com/), [jpv](http://jpverrue.fr), rawfiner,
[Matthieu Moy](https://matthieu-moy.fr/)
